<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Post Crop ‚Äì KrishiNect</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <select id="language">
      <option value="en">English</option>
      <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
      <option value="pa">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä</option>
      <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
      <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
      <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
      <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
      <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
      <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
      <option value="ur">ÿßÿ±ÿØŸà</option>
    </select>
    <h1 id="pageTitle">üì§ Post Your Crop</h1>
    <small id="tagline">Har Kisan Ka Digital Saathi</small>
  </header>

  <main>
    <button onclick="window.location.href='index.html'" class="back-btn">‚Üê Back to Home</button>

    <section class="form-section">
      <form id="cropForm">
        <input type="text" id="cropName" placeholder="Crop Name (e.g., Wheat)" required />
        <input type="number" id="quantity" placeholder="Quantity (kg)" required />
        <input type="text" id="location" placeholder="Your Village/Area" required />
        <input type="text" id="contact" placeholder="Contact Number" required />
        <button type="submit" id="submitBtn">Submit Crop</button>
      </form>
    </section>

    <section class="listings-section">
      <h2 id="yourListings">üß∫ Your Listings</h2>
      <div id="listingContainer">

      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import {
  getFirestore,
  collection,
  addDoc,
  query,
  where,
  getDocs,
  deleteDoc,   // ‚úÖ add this
  doc          // ‚úÖ add this
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";


    const firebaseConfig = {
  apiKey: "AIzaSyDazi9i6ZyQDfPrk8gx4pc1sp2RJvA2hNM",
  authDomain: "krishinect-39b8e.firebaseapp.com",
  projectId: "krishinect-39b8e",
  storageBucket: "krishinect-39b8e.firebasestorage.app",
  messagingSenderId: "894539525913",
  appId: "1:894539525913:web:1100591bbfc25c7148df88"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser;

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "signin.html";
      } else {
        currentUser = user;
        loadUserListings();
      }
    });
  
    document.getElementById("cropForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const cropName = document.getElementById("cropName").value;
      const quantity = document.getElementById("quantity").value;
      const location = document.getElementById("location").value;
      const contact = document.getElementById("contact").value;

      try {
        await addDoc(collection(db, "listings"), {
          cropName,
          quantity,
          location,
          contact,
          userId: currentUser.uid,
          date: new Date().toISOString()
          
        });
        

        alert("Listing posted successfully!");
        this.reset();
        loadUserListings();
      } catch (error) {
        console.error("Error adding listing:", error);
        alert("Error posting crop.");
      }
    });

    // Deletes a listing from Firestore
window.deleteListing = async function (id) {
  const confirmDelete = confirm("Are you sure you want to delete this listing?");
  if (!confirmDelete) return;

  try {
    await deleteDoc(doc(db, "listings", id));
    alert("Listing deleted successfully.");
    loadUserListings(); // Refresh the listings
  } catch (error) {
    console.error("Error deleting listing:", error);
    alert("Failed to delete the listing.");
  }
};


// Loads listings created by the logged-in user
async function loadUserListings() {
  const q = query(collection(db, "listings"), where("userId", "==", currentUser.uid));
  const snapshot = await getDocs(q);
  const container = document.getElementById("listingContainer");
  container.innerHTML = "";

  if (snapshot.empty) {
    container.innerHTML = "<p>No listings yet.</p>";
    return;
  }

  snapshot.forEach((docSnap) => {
    const data = docSnap.data();
    const dateStr = data.date ? new Date(data.date).toLocaleDateString() : "N/A";

    const div = document.createElement("div");
    div.className = "listing";
    div.innerHTML = `
      <strong>üåæ Crop:</strong> ${data.cropName}<br>
      <strong>üì¶ Quantity:</strong> ${data.quantity} kg<br>
      <strong>üìç Location:</strong> ${data.location}<br>
      <strong>üìû Contact:</strong> ${data.contact || "N/A"}<br>
      <strong>üóì Posted:</strong> ${dateStr}<br>
      <button class="delete-btn" onclick="deleteListing('${docSnap.id}')">üóë Delete</button>
    `;
    container.appendChild(div);
  });
}




  </script>

  <script>
    const translations = {
      en: {
        pageTitle: "üì§ Post Your Crop",
        tagline: "Har Kisan Ka Digital Saathi",
        yourListings: "üß∫ Your Listings",
        submitBtn: "Submit Crop",
        cropName: "Crop Name (e.g., Wheat)",
        quantity: "Quantity (kg)",
        location: "Your Village/Area",
        contact: "Contact Number"
      },
      hi: {
        pageTitle: "üì§ ‡§Ö‡§™‡§®‡•Ä ‡§´‡§∏‡§≤ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
        tagline: "‡§π‡§∞ ‡§ï‡§ø‡§∏‡§æ‡§® ‡§ï‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§∏‡§æ‡§•‡•Ä",
        yourListings: "üß∫ ‡§Ü‡§™‡§ï‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó",
        submitBtn: "‡§´‡§∏‡§≤ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
        cropName: "‡§´‡§∏‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ (‡§ú‡•à‡§∏‡•á ‡§ó‡•á‡§π‡•Ç‡§Ç)",
        quantity: "‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§≤‡•ã)",
        location: "‡§ó‡§æ‡§Ç‡§µ / ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞",
        contact: "‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§®‡§Ç‡§¨‡§∞"
      }
      // Add more if needed
    };

    document.getElementById("language").addEventListener("change", function () {
      const lang = this.value;
      const t = translations[lang] || translations["en"];

      document.getElementById("pageTitle").textContent = t.pageTitle;
      document.getElementById("tagline").textContent = t.tagline;
      document.getElementById("yourListings").textContent = t.yourListings;
      document.getElementById("submitBtn").textContent = t.submitBtn;
      document.getElementById("cropName").placeholder = t.cropName;
      document.getElementById("quantity").placeholder = t.quantity;
      document.getElementById("location").placeholder = t.location;
      document.getElementById("contact").placeholder = t.contact;
    });
  </script>
</body>
</html>
