<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crop Listings – KrishiNect</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .listings-section h2 {
  padding: 1rem;
  margin-top: 2rem;
  font-size: 1.4rem;
  color: #2e7d32;
  border-bottom: 1px solid #ccc;
}

  </style>
</head>
<body>
  <header>
    <select id="language">
      <option value="en">English</option>
      <option value="hi">हिन्दी</option>
      <option value="pa">ਪੰਜਾਬੀ</option>
      <option value="mr">मराठी</option>
      <option value="bn">বাংলা</option>
      <option value="ta">தமிழ்</option>
      <option value="te">తెలుగు</option>
      <option value="gu">ગુજરાતી</option>
      <option value="kn">ಕನ್ನಡ</option>
      <option value="ur">اردو</option>
    </select>
    <h1 id="pageTitle">📋 Crop Listings</h1>
    <small id="tagline">Har Kisan Ka Digital Saathi</small>
  </header>

  <main>
    <button onclick="window.location.href='index.html'" class="back-btn">← Back to Home</button>
      <section class="listings-section">
  <h2>🧺 My Listings</h2>
  <div id="myListingsContainer"></div>

  <h2>🌾 Other Farmers' Listings</h2>
  <div id="otherListingsContainer"></div>
</section>


  </main>

  <script type="module">
   import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
  getAuth,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import {
  getFirestore,
  collection,
  getDocs,
  deleteDoc,
  doc,
  query,
  where
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

 const firebaseConfig = {
  apiKey: "AIzaSyDX8G6-2TdazvV96p6Xdk2lyCkYe-QsQL4",
  authDomain: "krishinect-9bb15.firebaseapp.com",
  projectId: "krishinect-9bb15",
  storageBucket: "krishinect-9bb15.firebasestorage.app",
  messagingSenderId: "536593597479",
  appId: "1:536593597479:web:0574ca0475301b7c92ba02"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser;

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    alert("Please log in.");
    window.location.href = "signin.html";
  } else {
    currentUser = user;
    loadListings();
  }
});

async function loadListings() {
  const querySnapshot = await getDocs(collection(db, "listings"));
  const myContainer = document.getElementById("myListingsContainer");
  const othersContainer = document.getElementById("otherListingsContainer");

  myContainer.innerHTML = "";
  othersContainer.innerHTML = "";

  querySnapshot.forEach((docSnap) => {
    const data = docSnap.data();
    const div = document.createElement("div");
    div.className = "listing";

    const dateStr = data.date ? new Date(data.date).toLocaleDateString() : "N/A";

    div.innerHTML = `
      <strong>🌾 Crop:</strong> ${data.cropName}<br>
      <strong>📦 Quantity:</strong> ${data.quantity} kg<br>
      <strong>📍 Location:</strong> ${data.location}<br>
      <strong>📞 Contact:</strong> ${data.contact || "N/A"}<br>
      <strong>🗓 Posted:</strong> ${dateStr}<br>
    `;

    if (data.userId === currentUser.uid) {
      // Add delete button for own listings
      const delBtn = document.createElement("button");
      delBtn.className = "delete-btn";
      delBtn.textContent = "🗑 Delete";
      delBtn.onclick = async () => {
        const confirmDel = confirm("Are you sure you want to delete?");
        if (confirmDel) {
          await deleteDoc(doc(db, "listings", docSnap.id));
          loadListings();
        }
      };
      div.appendChild(delBtn);
      myContainer.appendChild(div);
    } else {
      othersContainer.appendChild(div);
    }
  });
}

  </script>
</body>
</html>
